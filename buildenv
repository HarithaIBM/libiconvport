#export ZOPEN_TYPE="TARBALL"
export ZOPEN_TYPE="GIT"

export ZOPEN_TARBALL_URL="https://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.17.tar.gz"
export ZOPEN_GIT_URL="https://git.savannah.gnu.org/git/libiconv.git"
export ZOPEN_TARBALL_DEPS="make gettext"
export ZOPEN_GIT_DEPS="make gettext automake autoconf perl m4 gperf sed coreutils diffutils findutils groff"
export ZOPEN_EXTRA_CONFIGURE_OPTS="--enable-extra-encodings"
export ZOPEN_CHECK_OPTS='check -i'

rm -f patches
if [ "${ZOPEN_TYPE}x" = "TARBALLx" ]; then
	ln -s tarball-patches patches
else
  export ZOPEN_BOOTSTRAP='./autopull.sh'
  export ZOPEN_BOOTSTRAP_OPTS="&& ./autogen.sh"
	ln -s git-patches patches
fi

zopen_check_results()
{
  dir="$1"
  pfx="$2"
  chk="$1/$2_check.log"

  totalTests=198
  testsRun=$(grep '^/bin/bash ./check-' "${chk}" | wc -l)
  actualFailures=$((totalTests-testsRun))
  echo "totalTests:${totalTests}"
  echo "expectedFailures:1"
  echo "actualFailures:${actualFailures}"
}

zopen_append_to_env()
{
cat <<ZZ
#
# The following environment variable controls how new line conversion is done
# If you run under USS, you _probably_ want this
#
export ICONV_EBCDIC_ZOS_UNIX=1
if [ ! -z "\$ZOPEN_IN_ZOPEN_BUILD" ]; then
  export ZOPEN_EXTRA_CFLAGS="\${ZOPEN_EXTRA_CFLAGS} -I\$PWD/include"
  export ZOPEN_EXTRA_CXXFLAGS="\${ZOPEN_EXTRA_CXXFLAGS} -I\$PWD/include"
  export ZOPEN_EXTRA_LDFLAGS="\${ZOPEN_EXTRA_LDFLAGS} -L\$PWD/lib"
  export ZOPEN_EXTRA_LIBS="\${ZOPEN_EXTRA_LIBS} -liconv"

fi
ZZ
}

export ZOPEN_RUNTIME_DEPS=""

zopen_get_version() {
  ./src/iconv --version | head -1 | awk -F" |)" '{ print $4 }'
}
